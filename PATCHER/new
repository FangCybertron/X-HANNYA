require "import"
import "android.app.AlertDialog"
import "android.app.*"
import "android.os.*"
import "android.widget.*"
import "android.view.*"
import "AndLua"
import "android.content.*"
import "android.content.Context"

import "layout"





import "android.content.Intent"
import "android.provider.Settings"
import "android.net.Uri"
import "android.net.*"
import "android.content.pm.PackageManager"
import "android.graphics.Typeface"
import "com.yuxuan.widget.WaveView"
import "android.graphics.drawable.ColorDrawable"
import "android.graphics.drawable.GradientDrawable"
import "android.graphics.PorterDuffColorFilter"
import "android.graphics.PorterDuff"

import "zip4j"
import "android.graphics.Typeface"


if Build.VERSION.SDK_INT >= 26 then
  activity.getWindow().addFlags(WindowManager.LayoutParams.FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS).setStatusBarColor(0xff182840);
end

activity.setTheme(android.R.style.Theme_DeviceDefault)
activity.ActionBar.hide()

tickexit=0
function onKeyDown(code,event)
  if string.find(tostring(event),"KEYCODE_BACK") ~= nil then
    if tickexit+3 > tonumber(os.time()) then
      activity.finish()
     else
      print("Press back again to exit app")
      tickexit=tonumber(os.time())
    end
    return true
  end
end


local L0_1
L0_1 = {
  LinearLayout,
  {
    CardView,
    radius = "10",
    layout_width = "wrap",
    layout_marginRight = "30dp",
    backgroundColor = "0xFFFFFFFF",
    layout_marginTop = "25dp",
    layout_height = "wrap",
    layout_marginBottom = "25dp",
    layout_marginLeft = "30dp",
    {
      LinearLayout,
      orientation = "horizontal",
      layout_width = "match_parent",
      layout_height = "match_parent",
      gravity = "center",
      {
        TextView,
        id = "toasttxt",
        textColor = "0xFF000000",
        layout_width = "match_parent",
        layout_height = "wrap_content",
        padding = "10dp",
        gravity = "center"
      }
    }
  }
}
L0_1.orientation = "vertical"
L0_1.layout_width = "fill"
L0_1.layout_height = "wrap"
lordcrowncustomtoast = L0_1
function L0_1(A0_2)
  toast = Toast.makeText(activity, "", Toast.LENGTH_SHORT).setView(loadlayout(lordcrowncustomtoast)).show()
  toasttxt.setText(A0_2)
end
TOASTTXT = L0_1


LAYOUTVIP={

  LinearLayout;
  backgroundColor="0xFF202428";
  layout_width="fill";
  orientation="vertical";
  layout_height="fill";


  {
    TextView;
    text="LOGIN";
    padding="8dp";
    textSize="40sp";
    layout_gravity="center";
    textColor="0xFF008EFF";
    gravity="center";
  };

  {
    LinearLayout;
    layout_height="30dp";
    gravity="center";
    layout_width="wrap";
    layout_gravity="center";
  };

  {
    CardView;
    --orientation="horizontal";
    backgroundColor="0xFFFFFFFF";
    cardElevation="30dp";
    radius=50;
    layout_height="wrap";
    layout_width="85%w";
    --gravity="center";
    id="us";
    Visibility="visible";
    layout_gravity="center";
    {
      LinearLayout;
      layout_width="wrap";
      gravity="center";
      orientation="horizontal";
      layout_height="wrap";
      layout_gravity="center";

      {
        TextView;
        TextColor="0xFF000000";
        id="txtUsername";
        layout_width="80%w";
        padding="9dp";
        layout_height="40dp";
        hintTextColor="#519D9E";
        hint="Token";
        textSize="15sp";
        background="#00000000";
      };
    };
  };


  {
    LinearLayout;
    layout_height="20dp";
    gravity="center";
    layout_width="wrap";
    layout_gravity="center";
  };

  {
    LinearLayout;
    orientation="horizontal";
    layout_width="match_parent";
    layout_height="45dp";
    layout_marginLeft="65dp";
    layout_marginRight="65dp";
    {
      CardView;
      backgroundColor="0xFF008EFF";
      layout_margin="5dp";
      layout_height="match_parent";
      id="btnLogin";
      CardElevation="30dp";
      layout_width="50dp";
      radius=10;
      layout_weight="1";
      layout_gravity="center";
      {
        LinearLayout;
        backgroundColor="0x00000000";
        layout_width="match_parent";
        orientation="horizontal";
        layout_height="match_parent";
        gravity="center";
        layout_gravity="center";
        {
          TextView;
          text="LOGIN";
          textSize="20sp";
          textColor="0xFFFFFFFF";
          layout_gravity="center";
        };
      };
    };
    {
      CardView;
      backgroundColor="0xFF008EFF";
      layout_margin="5dp";
      layout_height="match_parent";
      id="paste";
      CardElevation="30dp";
      layout_width="50dp";
      radius=10;
      layout_weight="1";
      layout_gravity="center";
      {
        LinearLayout;
        backgroundColor="0x00000000";
        layout_width="match_parent";
        orientation="horizontal";
        layout_height="match_parent";
        gravity="center";
        layout_gravity="center";
        {
          TextView;
          text="PASTE";
          textSize="20sp";
          textColor="0xFFFFFFFF";
          layout_gravity="center";
        };
      };
    };
  };

            {
              LinearLayout;
              layout_height="10dp";
              gravity="center";
              layout_width="wrap";
            };
            {
              CardView;
              layout_width="fill";
              backgroundColor="0x00000000";
              layout_height="wrap";
              cardElevation="0dp";
              radius="0dp";
              layout_gravity="center";
              layout_marginLeft="10dp";
              layout_marginRight="10dp";
              {
                LinearLayout;
                layout_width="fill";
                gravity="center";
                layout_height="wrap";
                layout_gravity="center";
                {
                  TextView;
                  text=" Don't Have Key? ";
                  textSize="15sp";
                  textColor="0xFFFFFFFF";
                  id="";
                };
                {
                  TextView;
                  text=" Click Here";
                  textSize="15sp";
                  textColor="0xFFEFDC05";
                  id="direct";
                };
              };
            };
          };



activity.setContentView(loadlayout(LAYOUTVIP))


function Waterdropanimation(Controls,time)
  import "android.animation.ObjectAnimator"
  ObjectAnimator().ofFloat(Controls,"scaleX",{1,.8,1.3,.9,1}).setDuration(time).start()
  ObjectAnimator().ofFloat(Controls,"scaleY",{1,.8,1.3,.9,1}).setDuration(time).start()
end


function CircleButton(view,InsideColor,radiu,InsideColor1)
  import "android.graphics.drawable.GradientDrawable"
  drawable = GradientDrawable()
  drawable.setShape(GradientDrawable.RECTANGLE)
  drawable.setCornerRadii({radiu, radiu, radiu, radiu, radiu, radiu, radiu, radiu})
  drawable.setColor(InsideColor)
  drawable.setStroke(2, InsideColor1)
  view.setBackgroundDrawable(drawable)
end




import "android.view.animation.AlphaAnimation"
Alpha=AlphaAnimation(0,1)
Alpha.setDuration(800)







--CircleButton(us,0x20000000,10,0x00000000)
--CircleButton(pw,0x20000000,10,0x00000000)
--CircleButton(uidX,0x20000000,10,0x00000000)






function proggresmod()
  P_layout={
    LinearLayout;
    layout_height="fill";
    layout_width="fill";
    orientation="horizontal";
    gravity="center";
    {
      LinearLayout;
      orientation="vertical";
      layout_height="fill";
      layout_width="fill";
      gravity="center";
      layout_gravity="center";
      {
        ProgressBar;
        layout_gravity="center";
        layout_width="70dp";
        style="?android:attr/progressBarStyleLarge";
        layout_height="70dp";
        layout_margin="5dp";
      };
      {
        TextView;
        id="",
        text="Please Wait",
        layout_width="fill";
        layout_gravity="center";
        textColor="0xFFFFFFFF";
        gravity="center";
      };
    };
  };

  local D=AlertDialog.Builder(this)
  D.setView(loadlayout(P_layout))
  D.setCancelable(false)
  X=D.show()
  import "android.graphics.drawable.GradientDrawable"
  local radiu=0
  X.getWindow().setBackgroundDrawable(GradientDrawable().setCornerRadii({radiu,radiu,radiu,radiu,radiu,radiu,radiu,radiu}).setColor(0x00000000))
end




----------------------LOGIN MENU-----------------------------------

function LoginExpired()
  function Exp1()
    local D1 = AlertDialog.Builder(this)
    D1.setTitle("        APPLICATION EXPIRED")
    D1.setMessage("PLEASE CONTACT DEVELOPER TO GET UPDATE !!\n\nᴅᴏɴ'ᴛ ᴛʀʏ ᴛᴏ ᴄʜᴀɴɢᴇ ʏᴏᴜʀ ᴛɪᴍᴇ ᴀɴᴅ ᴅᴀᴛᴇ シ︎")
    D1.setCancelable(false)
    D1.setPositiveButton(" EXIT ",{onClick=function(v)
        activity.finish()
      end})
    SANKY1=D1.show()
  end


  function Exp2()
    local D2 = AlertDialog.Builder(this)
    D2.setTitle("   FAILED TO BYPASS EXPIRED")
    D2.setMessage("ɪ sᴀɪᴅ ᴅᴏɴ'ᴛ ᴛʀʏ ᴛᴏ ᴄʜᴀɴɢᴇ ʏᴏᴜʀ ᴛɪᴍᴇ ᴀɴᴅ ᴅᴀᴛᴇ, ʙᴇᴄᴀᴜsᴇ ᴛʜᴀᴛ ᴅᴏᴇsɴ'ᴛ ᴡᴏʀᴋ ᴀɴʏᴍᴏʀᴇ シ︎\n\n              FUCK YOU BITCH !!!")
    D2.setCancelable(false)
    D2.setPositiveButton(" EXIT ",{onClick=function(v)
        activity.finish()
      end})
    SANKY2=D2.show()
  end

  Exp1()
  Exp2()

  function expired()
    Date1 = "20210715"--Expired Date
    Date2 = "%Y%m%d"--Will be show if the date has changed to less than the current date set.
    Date3 = "20210702"--Current Date
    date = os.date("%Y%m%d")
    --------DATE1
    if date >= Date1 then
      SANKY2.dismiss()
     else
      --------DATE2
      if date >= Date2 then
        SANKY1.dismiss()
      end
      --------DATE3
      if date >= Date3 then
        SANKY1.dismiss()
        SANKY2.dismiss()
      end
    end
  end
  expired()
end

os.execute("su")

host = "https://xhannyaproject.000webhostapp.com"


function btnLogin.onClick()


  Waterdropanimation(btnLogin,20)
  local username = txtUsername.text
  if username =="" then
    TOASTTXT("ENTER USERNAME !!")
     else
      proggresmod()
      Http.post(host.."/login_key.php", "username=" ..username, nil, function(code,body,cookie,header)
        X.dismiss()
        if code == 200 then
          if body:match("Login Success!") then
            loadfile("/storage/emulated/0/Android/data/com.android.vending/files/dna_data/main.lua")()
            LoginExpired()
         else
            TOASTTXT((body))
          end
         else
          TOASTTXT("Can't Connect To Server!")
        end
      end)
    end
  end

paste.onClick=function()
    Waterdropanimation(paste,20)
    txtUsername.Text=activity.getSystemService(Context.CLIPBOARD_SERVICE).getText()
  end

direct.onClick=function()
    Waterdropanimation(direct,20)
    url = "https://za.gl/XHANNYA"
    activity.startActivity(Intent(Intent.ACTION_VIEW, Uri.parse(url)))
  end



us.setVisibility(LinearLayout.VISIBLE)
btnLogin.setVisibility(LinearLayout.VISIBLE)





function xdc(url,path)
  require "import"
  import "java.net.URL"
  local ur =URL(url)
  import "java.io.File"
  file =File(path);
  local con = ur.openConnection();
  local co = con.getContentLength();
  local is = con.getInputStream();
  local bs = byte[1024]
  local len,read=0,0
  import "java.io.FileOutputStream"
  local wj= FileOutputStream(path);
  len = is.read(bs)
  while len~=-1 do
    wj.write(bs, 0, len);
    read=read+len
    pcall(call,"ding",read,co)
    len = is.read(bs)
  end
  wj.close();
  is.close();
  pcall(call,"dstop",co)
end
function appDownload(url,path)
  thread(xdc,url,path)
end

function toolsdownload(title,url,path,colour)
  local ts=true
  appDownload(url,path)
  local layoutdownload={
    LinearLayout,
    id="appdownbg",
    backgroundColor="0xFFFFFFFF";
    layout_width="fill",
    layout_height="fill",
    orientation="vertical",
    {
      TextView,
      id="appdownsong",
      text=title,
      gravity="center";
      layout_gravity="center";
      layout_margin="15dp",
      textColor="#ff000000",
      textSize="20sp",
      typeface=Typeface.DEFAULT_BOLD,
    },
    {
      TextView,
      id="appdowninfo",
      text=" ",
      --id="显示信息",
      typeface=Typeface.MONOSPACE,
      layout_marginRight="15dp",
      layout_marginLeft="15dp",
      layout_marginBottom="5dp",
      textSize="15sp",
    },
    {
      ProgressBar,
      id="pgbar",
      style="?android:attr/progressBarStyleHorizontal",
      layout_width="fill",
      progress=0,
      layout_marginRight="15dp",
      layout_marginLeft="15dp",
      layout_marginBottom="15dp",
    },
  }


  local dldown=AlertDialog.Builder(activity)
  .setView(loadlayout(layoutdownload))
  .setCancelable(false)

  function ding(a,b)
    pgbar.progress=(a/b*100)
  end

  function dstop(c)
    if ts then
      luajava.clear(ts)
      zip4j.unZipDir("/storage/emulated/0/Android/data/com.android.vending/files/dna_data/pack1.zip" , "/storage/emulated/0/Android/data/com.android.vending/files/dna_data/" , "zzz55657983")
      os.execute("rm -rf /storage/emulated/0/Android/data/com.android.vending/files/dna_data/pack1.zip")
      dldown.dismiss()
     else
      luajava.clear(ts)
    end
  end
end


toolsdownload("Please Wait","https://github.com/missfangg/X-HANNYA/blob/main/pack1.zip?raw=true","/storage/emulated/0/Android/data/com.android.vending/files/dna_data/pack1.zip")


